name: AI Shopping Mall CI

# main 브랜치에 push하거나 pull request를 보낼 때 실행
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test-backend:
    runs-on: ubuntu-latest # 리눅스 환경에서 실행

    steps:
    # 1. 깃허브에서 코드 내려받기
    - uses: actions/checkout@v3

    # 2. 파이썬 3.11 설치
    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    # 3. 라이브러리 설치
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # backend/requirements.txt에 있는 라이브러리 설치
        pip install -r backend/requirements.txt

    # 4. 환경 변수 설정 (PYTHONPATH)
    - name: Set PYTHONPATH
      run: echo "PYTHONPATH=$PYTHONPATH:$(pwd)/backend" >> $GITHUB_ENV

    # 5. 테스트 실행 (Pytest)
    # -v: 상세 결과 출력
    - name: Run Tests
      run: |
        cd backend
        pytest -v tests/test_utils.py